## Re:Clip 実装ギャップ分析（要件定義ベース）

最終更新: 2025-01-30

---

### Capture（保存導線）
- 現状実装
  - Web版の`SaveItemDialog`でURL/フォルダ/メモ入力→保存は可能。
  - チャンネルは固定で`web`、保存成功トーストあり。
  - 重複URL検知、クリップボード自動挿入、iOS共有シート連携は未実装。
  - 保存処理は`localStorage`またはSupabase `items`表に直書き。
- 要件差分
  - 「2タップ以内」「操作回数2.5以内」の指標に対するUI最適化が未着手。
  - `channel`や`source_platform`の自動設定は一部対応済みだが、保存導線のバリエーション（共有シート等）が不足。
  - 保存完了P95≤4秒を測定する仕組みがない。
- メモ
  - `useItems.addItem`でURL正規化や重複チェックを追加する余地あり。
  - 保存時の失敗トーストやリトライUX未整備。
- チェックリスト
  - [x] WebでURL保存できるダイアログを提供
  - [ ] 重複URL検知とユーザー通知
  - [ ] 共有シート / 拡張機能など追加保存導線
  - [ ] クリップボードからの自動入力
  - [ ] 保存処理の計測（操作回数・P95時間）
  - [ ] 保存失敗時のリトライUX

### Enrich & Presentation（自動整備/表示）
- 現状実装
  - Supabase Functions `unfurl-metadata` / `enrich-content` / `apply-folder-rules` は呼び出されている。
  - `note_ai`に要約、`tags_ai`・`folder_ai`を格納。OG画像・ドメインも保持。
- メタデータ取得失敗時の再試行ボタンや失敗通知は未実装。
  - Inboxカードでタイトル/要約/タグ/OG画像を表示。"今日保存"等のハイライトなし。
- 要件差分
  - 要件で定義した`summary_ai`表現や信頼度バッジ、本文冒頭抽出は未対応。
  - リストの優先度順（未読上位、AI推奨順）やサマリ表示最適化が不足。
  - メタデータをP95 8秒で反映する性能計測・保証が無い。
- チェックリスト
  - [x] Supabase Functionsでメタデータ/AI要約を取得
  - [ ] 失敗時の再取得ボタンと通知
  - [ ] AI要約を`summary_ai`等へ整理し信頼度を表示
  - [ ] 「今日保存」など視覚的ハイライトを追加
  - [ ] AI推奨順ソートや優先度指標の導入
  - [ ] メタデータ反映時間の計測

### Remind & Habit（夜通知/リマインド）
- 現状実装
  - UIに通知設定セクションはあるが、実際の夜21時通知機能は未実装。
  - `profiles`テーブルで`notification_enabled/time`を保存するのみ。
- 要件差分
  - 夜のリマインド通知、条件ロジック、通知からInboxハイライトへの導線が未着手。
  - 翌朝リマインドや週間サマリも未実装。
  - 通知履歴やUX計測イベントが存在しない。
- チェックリスト
  - [ ] 夜のリマインド通知を実装（21時デフォルト）
  - [ ] 通知条件ロジックとInbox遷移を実装
  - [ ] 翌朝リマインド/週間サマリのロードマップ化
  - [ ] 通知送信ログ/計測を整備

### Review & Act（振り返り/アクション）
- 現状実装
  - Inboxカードから詳細画面へ遷移し、タイトル/メモ/タグを編集可能。
  - 外部リンク、コピー、削除、フォルダ管理はあり。
  - 既読/未読の切替、夜リマインド対象フィルタ、Markdownコピーは未実装。
  - 外部リンクを開いても`read_at`更新処理は無い（イベントログのみ）。
- 要件差分
  - 詳細画面での「その場で読了」支援（既読設定、Quick Actions）が不足。
  - リスト上でのクイック操作（既読/アーカイブ/メモ追記）が無い。
  - Markdownコピーや後続アクション導線は未実装。
- チェックリスト
  - [x] 詳細画面でタイトル/メモ/タグを編集
  - [ ] 既読/未読トグルとQuick Actions
  - [ ] Inboxカード上でのクイック操作（既読/アーカイブなど）
  - [ ] Markdownコピー機能
  - [ ] 既読反映（リンククリック時に`read_at`更新）

### Sync & Modes（ローカル/クラウド/同期）
- 現状実装
  - ローカルモードは`localStorage`に配列保存、クラウドモードはSupabase。
  - モード切替UIと永続化はあり。
  - ローカル→クラウド移行ツール、オフラインキュー、匿名キーでのFunction呼び出し制御は未整備。
- 要件差分
  - ローカルモードでのIndexedDB使用やオフラインキューが未対応。
  - クラウド同期をプレミアム化する設計・機能フラグ無し。
  - 課金/認証フローの整理が未着手。
- チェックリスト
  - [x] ローカル/クラウドのモード切替UI
  - [x] Supabaseでクラウド保存
  - [ ] IndexedDBベースのローカル保存 + オフラインキュー
  - [ ] ローカル→クラウド移行フロー
  - [ ] プレミアム機能のフラグ管理
  - [ ] 匿名キー運用/セキュリティレビュー

...
